<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<head>
  <title>Talisman Calculator</title>
  <meta name="viewport" content="width=320">
  <meta name="viewport" content="initial-scale=1.0">
<style type="text/css">
.purple {background-color:Plum}
.blue {background-color:LightSkyBlue}
.green {background-color:PaleGreen}
.white {background-color:white}
.big {font-size:150%}
.res1 {width:100%}
.res2 {width:100%}
.powerin {width:100%}
</style>
<script type="text/javascript">
<!--
// data from warhammeralliance.com forums, largely from the tables
// Tamara made and the ensuing discussion
var minLevel = new Array(1,6,6,11,11,21,21,31,31,36);
var critDur = new Array(1,2,3,4,5,6,9,10,13,14);
var powerVal = new Array(5,6,8,9,11,12,14,15,17,18);
// powerVal assumes the first two values in Tamara's tables are off by one
var afVal = new Array(22,30,37,45,52,60,67,75,82,90);

function talisman(tier,color,head)
{
    if ( color > 3 ) { color = 3; }
    var talismanData = new Array(   2+tier+4*color,
                                    (color+1)+"%/"+ critDur[tier-1] + "d",
                                    5 + 5*tier + 15*color,
                                    powerVal[tier-1] + 6*color,
                                    afVal[tier-1] + 30*color,
                                    minLevel[tier-1] );
    var dataNames = new Array(  "Stat",
                                "Crit",
                                "Resist",
                                "Power",
                                "AF",
                                "Min Lvl" );
    var tdOpen = '<td align="center">';
    var tdClose = "</td>";
    var row = new Array(    talismanData[parseInt(window.document.tf.kind.value)],
                            talismanData[5] );
    if ( head == 1 ) {
        tdOpen = "<th>";
        tdClose = "</th>";
         var row = new Array(   dataNames[parseInt(window.document.tf.kind.value)],
                                dataNames[5] );
   }
    if ( head == 2 ) {
        tdOpen = tdOpen + "<b>";
        tdClose = "</b>" + tdClose;
    }
    var out = "";
    for (i = 0; i < 2; ++i) {
        out += tdOpen + row[i] + tdClose;
    }
    return out;
}

function recalculate()
{
    var color = parseInt(window.document.tf.color.value);
    var power = parseInt(window.document.tf.fragment.value);
    power += parseInt(window.document.tf.curio.value);
    power += parseInt(window.document.tf.gold.value);
    power += parseInt(window.document.tf.essence.value);
    if ( window.document.tf.box.checked == true ) {
        power += 1;
    }
    if ( window.document.tf.lowskill.checked == true ) {
        power -= 1;
    }

    var makeTier = powerToTier(power);    
    var out = '<p>What you will usually make:</p><p><table rules="all" class="res1"><tr><th>Total Power</th>' + talisman(0,0,1) + "</tr>";
    if ( makeTier < 10 ) {
        var gap = tierToPower(makeTier+1) - power;
        out += '<tr class="' + colorClass(color) + '">' + 
            '<td align="center">' + tierToPower(makeTier+1) + " (+" + gap + ")</td>" + talisman(makeTier+1,color,0) + "</tr>";
    }
    out += '<tr style="font-size:125%" class="' + colorClass(color) + '">' +
        '<td align="center""><b>' + power + "</b></td>" + talisman(makeTier,color,2) + "</tr>";
    if ( makeTier > 1 ) {
        var gap = power - tierToPower(makeTier) + 1;
        out += '<tr class="' + colorClass(color) + '">' +
            '<td align="center">' + (tierToPower(makeTier) - 1) + " (-" + gap + ")</td>" + talisman(makeTier-1,color,0) + "</tr>";
    }
    out += "</table></p>";
    out += "<p>If you get lucky:</p>";
    out += '<p><table rules="all" class="res2"><tr><th></th>' + talisman(0,0,1) + '</tr>';
    out += '<tr class="' + colorClass(color) + '">' +
        '<td align="center">Special</td>' + talisman(powerToTier(power+6),color,0) + '</tr>';
    out += '<tr class="' + colorClass(color+1) + '">' +
        '<td align="center">Awesome</td>' + talisman(powerToTier(power+1),color + 1,0) + '</tr>';
    out += '</table></p>';
    document.getElementById("results").innerHTML = out;
}

function powerToTier(power)
{
    var tier = 1;
    for ( nextTier = 2; nextTier <= 10; ++nextTier ) {
        if ( tierToPower(nextTier) > power ) { return tier; }
        tier = nextTier;
    }
    return tier;
}

function tierToPower(tier)
{
    var power = 5*tier-3;
    if ( tier > 1 ) { power += 2; }
    if ( tier > 4 ) { power += 1; }
    if ( tier > 8 ) { power += 1; }
    return power;
}

function colorClass(color)
{
    switch(color) {
        case 0: return "white"; break;
        case 1: return "green"; break;
        case 2: return "blue"; break;
        default: return "purple"; break;
    }
}

function setall(skill)
{
    var tier = Math.floor(skill/25) + 1
    for ( i = 0; i < 10; ++i )
    {
        if ( i != 9 ) {
            window.document.tf.fragment[i].checked = false;
        }
        window.document.tf.fragment[tier-1].checked = true;
        
        window.document.tf.curio[i].checked = false;
        window.document.tf.curio[tier].checked = true;
        
        window.document.tf.gold[i].checked = false;
        window.document.tf.gold[tier].checked = true;

        window.document.tf.essence[i].checked = false;
        window.document.tf.essence[tier].checked = true;
    }
    recalculate();
}

//-->
</script></head>
<body onLoad="recalculate();">
  <form action="#" method="get" name="tf">
  <p>
    <select name="color" onchange="recalculate();">
        <option value="0">white</option>
        <option value="1">green</option>
        <option value="2">blue</option>
        <option value="3" selected="selected">purple</option>
    </select>
    <select name="kind" onchange="recalculate();">
        <option value="0" selected="selected">stat</option>
        <option value="1">crit</option>
        <option value="2">resist</option>
        <option value="3">power</option>
        <option value="4">armor</option>
    </select>
  </p>
  <p>
  <input name="box" type="checkbox" onClick="recalculate();" />200 container<br/>
  <input name="lowskill" type="checkbox" onClick="recalculate();" />Penalty for low skill<br/>
  </p>
  <p>
  <table class="powerin">
    <tr>
        <td>Fragment</td>
        <td>Curio</td>
        <td>Gold</td>
        <td>Essence</td>
    </tr>
    <tr>
    <td>
    <select name="fragment" onchange="recalculate();">
        <option value="2">1</option>
        <option value="4">25</option>
        <option value="6">50</option>
        <option value="8">75</option>
        <option value="10">100</option>
        <option value="12">125</option>
        <option value="14">150</option>
        <option value="16" selected="selected">175</option>
        <option value="18">200</option>
    </select>
    </td>
    <td>
    <select name="curio" onchange="recalculate();">
        <option value="0">none</option>
        <option value="1">1</option>
        <option value="2">25</option>
        <option value="3">50</option>
        <option value="4">75</option>
        <option value="5">100</option>
        <option value="6">125</option>
        <option value="7">150</option>
        <option value="8" selected="selected">175</option>
        <option value="9">200</option>
    </select>
    </td>
    <td>
    <select name="gold" onchange="recalculate();">
        <option value="0">none</option>
        <option value="0">none</option>
        <option value="1">1</option>
        <option value="2">25</option>
        <option value="3">50</option>
        <option value="4">75</option>
        <option value="5">100</option>
        <option value="6">125</option>
        <option value="7">150</option>
        <option value="8" selected="selected">175</option>
        <option value="9">200</option>
    </select>
    </td>
    <td>
    <select name="essence" onchange="recalculate();">
        <option value="0">none</option>
        <option value="0">none</option>
        <option value="1">1</option>
        <option value="2">25</option>
        <option value="3">50</option>
        <option value="4">75</option>
        <option value="5">100</option>
        <option value="6">125</option>
        <option value="7">150</option>
        <option value="8" selected="selected">175</option>
        <option value="9">200</option>
    </select>
    </td>
  </table>
  </p>
  </form>
  <div id="results"><p>results go here</p>
  </div>
</body>
</html>
